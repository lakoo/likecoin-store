/* eslint-disable */
import jsonStringify from 'fast-json-stable-stringify';
import BigNumber from 'bignumber.js';
import {  EXTERNAL_URL } from '@/constant';
import { StargateClient } from '@cosmjs/stargate';
import { linearRegression } from 'simple-statistics';
const COSMOS_RPC_API = `${EXTERNAL_URL}/api/cosmos/rpc`;
let stargateClient;

const sampleTransactions = [
  '19435A380D6A9A74CEA9ED39DA62ABA13FE4FED245C77C6D1C4FD73D69EC9BB2',
  'FD193C3CC1D382B8BF418D0B729866A98AF48A753EFE827388AB2C529E652D1A',
  '6062D0DA59E0755FD804F16A7299A13E7164C68A3A248EC1043C7DED9AE5E54B',
  'AB92185655EAA33C7D13DB7CD0FBC984B67FF94834D78C4FDC6837FD3716D282',
  'F105C4534056976C311D1F4BC6F406324F3A755087DAB8E108E5FB5C43A57C47',
  'E8E5B1D04A0D49731CE96CA37F088EB5401AE5E7842965C5CD47F8B78D7EBA1B',
  '5E7CEB29BCCDA562444E42CB21350281794F6AEA0E6990E9A127FC00B7A35960',
  '8E51F77AA1F0FB0A36897E2238463F5B19475561D5C88C91DA48B043D4E86096',
  'F09B9C6094BEB0272FE112D95400D174F0201040194707A12686B285CB160137',
  'D922DD970BA65945F5DCD888BE7DA645892BBFF45AB317C522D462C83830F77C',
  '805DDAB4A97EFBD31BA0683303746D0E8BF0D172018531DFD9245B233AF0E6D9',
  '5698FAAC49F8B8E360DA6BE4DDC7C022B3C1A3EB84504BB25CD55961FD162964',
  '2B67E3DC9F2361EA360C6983D6257711857903689622B1BC060EDBA8C49BFA93',
  '1758BE4E1F7DA97697CAABEC91DAC9DB5831C45362BE8AD6E0AA7F43D2CE410F',
  'FAE6501D3AB78A2C761D06428ECCB4222752009978D8832C77252CC2C106C7E2',
  '6998EB006274D113CD95E41B7A038195C24B82F0B29415C7EFCB27A13714B166',
  '074E8B35B54112F23F53D227220096E14EFD431D7EE532526BF6C08F1E43D6D2',
  '58387DB7BB02F71EF00F7415B27A6D07C2968AB8843CFCAB4DAB3DE95D83454A',
  '5D469C6FFD1B6F872C3B49CBFE5CB77A7085CD6F11EE6DAF25B11638F8109BCB',
  '9032C69A3A56D419BA430455D812602C6605F30B8A4A809E276D06145CA33139',
  '58CB52A2EB17977C4B358E6AF6F35ED943FBFC961A24906708963431BC5847D4',
  'A02E2C93BB935C57CA189C7351B82037EC9C45BBA1A3EB3B9D9084C8C9A1C0B7',
  'AF77DEB505FEB9BEAC1C1FFD44CBADBBAEDF178B0DF88A020FA3A66600A8896D',
  '5C2818D77AD6481234C70AF40A7336B26100176F16F970D036C9FC726CE0D2D2',
  '12A7DEC5E75CB622567AC688BBBDF1D74CAA39E78233B4B9210640E5D2AE0138',
]



async function initStargateClient() {
  if (stargateClient) return;
  stargateClient = await StargateClient.connect(COSMOS_RPC_API);
}

export async function getGasLimitParams() { // eslint-disable-line
  const scatterDots = [];
  const transactions = [];
  for (let i = 0; i < sampleTransactions.length; i ++ ) {
    if (!stargateClient) await initStargateClient();
    const singleTx = {};
    const scatterDot = [];
    const data = await stargateClient.getTx(sampleTransactions[i]); // eslint-disable-line
    const { gasUsed } = data;
    const transactionBytes = data.tx; // a binary data
    const byteSize = Buffer.from(jsonStringify(transactionBytes), 'utf-8').length

    singleTx.hash = sampleTransactions[i];
    singleTx.byteSize = byteSize;
    singleTx.gasUsed = gasUsed;
    transactions.push(singleTx);
    scatterDot.push(byteSize);
    scatterDot.push(gasUsed);
    scatterDots.push(scatterDot);
  }
  const regressionResult = linearRegression(scatterDots); // example data: slop = 3.567 ; intercept: 99784
  const slop = BigNumber(regressionResult.m);
  const intercept = BigNumber(regressionResult.b);

  return { slop, intercept }
}

